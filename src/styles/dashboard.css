:root {
  --bg:#f4f4f4; --text:#333; --muted:#666; --brand:#5e5cb8; --card:#e0e0e0; --border:#cfcfcf; --side-w: 300px;
  --green:#22c55e; --red:#ef4444; --yellow:#f59e0b; --purple:#a855f7; --orange:#fb923c;
}

* { box-sizing: border-box; }
html, body {
  margin: 0;
  padding: 0;
}
body {
  margin: 0; font-family: Arial, sans-serif; background: var(--bg); color: var(--text);
  min-height: 100vh; display: grid; grid-template-rows: auto 1fr auto;
}
.app-header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px 20px; background:#fff; border-bottom:1px solid var(--border);
  position: relative; z-index: 1100; /* asegura clic sobre el mapa/overlays */
  margin: 0; /* por si acaso */
  margin-bottom: 0;
  /* ya tienes border-bottom; déjalo */
}
.brand { display: flex; align-items: center; gap:10px; }
.logo { width: 36px; height: auto; }
.user-area { display:flex; align-items:center; gap:12px; }
.user-card { display:flex; align-items:center; gap:10px; }
.avatar {
  width: 40px; height: 40px; border-radius: 50%;
  background:#e5e7eb; display:flex; align-items:center; justify-content:center;
  font-size: 20px;
}
.user-meta { display:flex; flex-direction:column; gap:4px; }
.welcome { font-weight:600; line-height:1.1; }
.user-email { color: var(--muted); font-size: 14px; }
.btn-out {
  background: var(--brand); color:#fff; border:0; padding:8px 12px; border-radius:8px; cursor:pointer;
}
.btn-out:hover { filter: brightness(0.9); }

.app-main { position: relative; padding: 0; transition: margin-right .25s ease; }
.app-main.shifted { margin-right: var(--side-w); }
#map {
  width:100%; height:100%; min-height: calc(100vh - 120px);
  margin-top: 0;
}
.leaflet-container { background: #fff; }

/* Atribución discreta propia */
.map-attrib {
  position: absolute;
  right: 12px;
  bottom: 12px;
  font-size: 11px;
  color: #555;
  background: rgba(255,255,255,0.9);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 2px 6px;
  z-index: 1000;
  pointer-events: none; /* no bloquea clics en el mapa */
}
.leaflet-control-attribution { display:none !important; } /* ocultamos la de Leaflet */

/* Overlay del menú sobre el mapa */
.map-menu {
  position: absolute;
  right: 70px;
  bottom: 35px;
  width: 320px;
  max-width: calc(100% - 32px);
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: 0 10px 24px rgba(0,0,0,.18);
  z-index: 1200;
  display: none;
}
.map-menu.show { display: block; }
.map-menu-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 12px;
  border-bottom: 1px solid var(--border);
}
.map-menu-title { margin: 0; font-size: 16px; }
.map-menu-close {
  border: 0;
  background: transparent;
  font-size: 20px;
  line-height: 1;
  cursor: pointer;
  color: #666;
}
.map-menu-close:hover { color: #000; }
.map-menu-body { padding: 12px; }
.map-menu .signal-overall-status{
  background:#22c55e;
  color:#fff;
  font-weight:700;
  padding:6px 14px;
  border-radius:10px;
  display:inline-block;
  font-size:14px;
  margin-bottom:12px;
  box-shadow:0 2px 4px rgba(0,0,0,.15) inset;
}

/* Botón flotante a la derecha, centrado vertical */
.side-toggle {
  position: fixed; right: 12px; top: 50%; transform: translateY(-50%);
  z-index: 1100; width: 44px; height: 44px; border: 0; border-radius: 50%;
  background: var(--brand); color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,.2);
  display: grid; place-items: center; cursor: pointer;
}
.side-toggle:hover { filter: brightness(.95); }
.side-toggle.open svg { transform: rotate(180deg); transition: transform .2s; }

/* Panel lateral que desplaza el mapa */
.side-panel {
  position: fixed; top: 60px; right: calc(-1 * var(--side-w));
  width: var(--side-w); height: 85.2vh; background: #fff;
  border-left: 1px solid var(--border); box-shadow: -6px 0 16px rgba(0,0,0,.1);
  transition: right .25s ease; z-index: 1090; overflow-y: auto;
}
.side-panel.open { right: 0; }
.side-content { padding: 14px; display: grid; gap: 14px; }
.panel-section h3 { margin: 0 0 6px; font-size: 16px; font-weight: 700; color:#333; }

.panel-card { background: var(--card); border:1px solid var(--border); border-radius: 12px; padding: 10px; }
.stats .row { display: flex; justify-content: space-between; padding: 4px 2px; font-size: 14px; }
.c-green{ color: var(--green); } 
.c-yellow{ color: var(--yellow); } 
.c-purple{ color: var(--purple); } 
.c-orange{ color: var(--orange); } 
.c-red{ color: var(--red); }   /* añadido */

.legend { list-style: none; margin: 0; padding: 0; display: grid; gap: 8px; font-size: 14px; }
.legend li { display: flex; align-items: center; gap: 8px; }
.dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; border:1px solid rgba(0,0,0,.2); }
.dot-green{ background: var(--green); } .dot-red{ background: var(--red); } .dot-yellow{ background: var(--yellow); } .dot-purple{ background: var(--purple); }

.sub-title { font-weight: 700; margin: 6px 0 8px; }
.chk { display: flex; align-items: center; gap: 8px; margin: 6px 0; user-select: none; }
.chk input { appearance: none; -webkit-appearance: none; width: 0; height: 0; position: absolute; }
.chk .box { width: 20px; height: 20px; border-radius: 6px; border: 2px solid #d1d5db; display: inline-grid; place-items: center; background:#fff; }
.chk input:checked + .box { background: #fff; border-color: var(--brand); }
.chk input:checked + .box::after { content: '✔'; font-size: 14px; line-height: 1; color: var(--brand); }

.select select { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid #d1d5db; background: #fff; }
.signal-table-wrapper { font-size:14px; }
.signal-table {
  width:100%; border-collapse:collapse; background:#ffffff;
  border:2px solid #6b6b6b; border-radius:0px; overflow:hidden;
}
.signal-table thead th {
  background:#ffffff; text-align:left;
  font-weight:100; border-right:1.5px solid #000000; color:#000000;
}
.signal-table thead th:last-child { border-right:0; }
.signal-table tbody td {
  padding:10px 6px; text-align:center; font-weight:700;
  border-top:2px solid #6b6b6b; border-right:2px solid #6b6b6b;
}
.signal-table tbody td:last-child { border-right:0; }
.status-dot{
  display:inline-block;
  width:24px;
  height:24px;
  border-radius:50%;
  background:#22c55e;
  border:2px solid rgba(0,0,0,.2);
}
.signal-status-box{
  margin-top:12px;
  background:#6b6b6b;
  color:#fff;
  padding:12px 16px;
  border-radius:6px;
  font-weight:700;
  font-style:italic;
  font-size:14px;
}

.falla-modal{
  position:fixed; inset:0; background:rgba(0,0,0,.45);
  display:flex; align-items:flex-start; justify-content:flex-end;
  z-index:1600;
}
.falla-modal-box{
  background:#fff; width:420px; max-width:90%;
  padding:20px 22px; border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
  font-size:14px;
}
.falla-modal-box h4{margin:0 0 14px; font-size:18px;}
.falla-modal-box form label{display:flex; flex-direction:column; gap:4px; font-weight:400; margin-bottom:10px;}
.falla-modal-box input,
.falla-modal-box textarea{
  padding:8px 10px; border:1px solid #d1d5db;
  border-radius:8px; font:inherit; background:#fff;
}
.falla-modal-actions{display:flex; gap:10px; margin-top:4px;}
.btn-danger{background:#ef4444; color:#fff;}
.header-search{
  flex:1;
  display:flex;
  justify-content:center;
  padding:0 20px;
  max-width:480px;
  position:relative;
}
.header-search input{
  width:100%;
  padding:8px 12px;
  border:1px solid #d1d5db;
  border-radius:8px;
  font:inherit;
  background:#fff;
  outline:none;
}
.header-search input:focus{ border-color: var(--brand); box-shadow:0 0 0 2px rgba(94,92,184,.2); }

/* Lista rectangular de sugerencias */
.signal-suggestions{
  position:absolute; top:100%; left:0; right:0;
  background:#fff; border:1px solid #d1d5db; border-radius:8px;
  margin-top:6px; box-shadow:0 6px 18px rgba(0,0,0,.12);
  max-height:260px; overflow:auto; padding:6px 0; z-index:1500;
}
.signal-suggestions.hidden,[hidden].signal-suggestions{ display:none; }
.signal-suggestions .sugg-item{
  padding:8px 14px; cursor:pointer; font-size:14px; line-height:1.3;
  display:flex; align-items:center; gap:8px;
}
.signal-suggestions .sugg-item:hover,
.signal-suggestions .sugg-item.active{
  background: #f1f5f9;
}
.signal-suggestions .sugg-item .badge{
  font-size:11px; padding:2px 6px; border-radius:4px;
  background: var(--brand); color:#fff; font-weight:600;
}
/* Scrollbar ligera (opcional) */
.signal-suggestions::-webkit-scrollbar{ width:8px; }
.signal-suggestions::-webkit-scrollbar-track{ background:transparent; }
.signal-suggestions::-webkit-scrollbar-thumb{ background:#cbd5e1; border-radius:4px; }
.signal-suggestions::-webkit-scrollbar-thumb:hover{ background:#94a3b8; }

.user-btn{ border:0; background:transparent; padding:0; cursor:pointer; display:flex; align-items:center; }


.app-footer {
  padding: 6px 10px;        /* más pequeño */
  font-size: 12px;          /* texto más pequeño */
  text-align: center;       /* centrado */
  background: #fff;
  border-top: 1px solid var(--border);
  color: var(--muted);
}

/* Rompe colapso de márgenes y evita gap subpíxel con zoom */
.app-main {
  padding: 0;
  margin: 0;
  display: flow-root;           /* crea BFC, evita colapso */
  border-top: 1px solid transparent; /* neutral y rompe colapso */
}

/* Asegura que el primer hijo no empuje hacia abajo el header */
.app-main > *:first-child { margin-top: 0 !important; }

/* Por si #map u otros traen margen por error */
#map, .map-attrib, #mapMenu, #sideMenu { margin-top: 0 !important; }